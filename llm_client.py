import requests
import asyncio
import json
import aiohttp
from config import (
    OPENROUTER_API_URLS, OPENROUTER_API_KEY, OPENROUTER_MODEL, 
    OPENROUTER_HEADERS, DEBUG_MODE, DISABLE_SSL_VERIFY, ALTERNATIVE_MODELS
)
import logging
from rddm_info import get_rddm_knowledge
from session_manager import PostSize

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# –ù–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç
RDDM_DATASET = {
    "F&Q": [
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –≠–∫–æ–ª–æ–≥–∏—è, #–≠–∫–æ–ª–æ–≥–∏—è–ü–µ—Ä–≤—ã—Ö",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –ü—Ä–æ—Ñ–µ—Å—Å–∏—è, #–ü—Ä–æ—Ñ–µ—Å—Å–∏—è–ü–µ—Ä–≤—ã—Ö",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è, #–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è–ü–µ—Ä–≤—ã—Ö",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –î–æ–±—Ä–æ, #–î–æ–±—Ä–æ–ü–µ—Ä–≤—ã—Ö",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –ù–∞—É–∫–∞, #–ù–∞—É–∫–∞–ü–µ—Ä–≤—ã—Ö",
        "–ö–í–ù –ü–µ—Ä–≤—ã–µ | –î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö, #–ö–í–ù–ü–µ—Ä–≤—ã–µ",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –°–ø–æ—Ä—Ç –∏ –ó–û–ñ, #–°–ø–æ—Ä—Ç–ó–û–ñ–ü–µ—Ä–≤—ã—Ö",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –ü–∞—Ç—Ä–∏–æ—Ç—ã, #–ü–∞—Ç—Ä–∏–æ—Ç—ã–ü–µ—Ä–≤—ã—Ö",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ, #–¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ–ü–µ—Ä–≤—ã—Ö",
        "–î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö. –î–∏–ø–ª–æ–º–∞—Ç—ã, #–î–∏–ø–ª–æ–º–∞—Ç—ã–ü–µ—Ä–≤—ã—Ö",
        "–ì—Ä–∞–Ω—Ç—ã | –î–≤–∏–∂–µ–Ω–∏–µ –ü–µ—Ä–≤—ã—Ö, #–≥—Ä–∞–Ω—Ç—ã–ü–µ—Ä–≤—ã—Ö"
    ],
    "HASHTAGS": {
        "–ú—ã - –≥—Ä–∞–∂–¥–∞–Ω–µ –†–æ—Å—Å–∏–∏": {
            "description": "–ü—Ä–æ–≥—Ä–∞–º–º–∞ ¬´–ú—ã ‚Äì –≥—Ä–∞–∂–¥–∞–Ω–µ –†–æ—Å—Å–∏–∏!¬ª —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –¥–µ–ª –†–§",
            "link": "https://vk.com/club26323016",
            "hashtag": "#–ú—ã–ì—Ä–∞–∂–¥–∞–Ω–µ–†–æ—Å—Å–∏–∏"
        },
        "–•—Ä–∞–Ω–∏—Ç–µ–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏": {
            "hashtag": "#–•—Ä–∞–Ω–∏—Ç–µ–ª–∏–ò—Å—Ç–æ—Ä–∏–∏"
        },
        "–ö–ª–∞—Å—Å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏": {
            "hashtag": "#–ö–ª–∞—Å—Å–Ω—ã–µ–í—Å—Ç—Ä–µ—á–∏",
            "link": "https://vk.com/klassnye_vstrechi"
        },
        "–ü–µ—Ä–≤–∞—è –ø–æ–º–æ—â—å": {
            "hashtag": "#–ü–µ—Ä–≤—ã–µ–ü–æ–º–æ–≥–∞—é—Ç"
        },
        "–ó–∞—Ä–Ω–∏—Ü–∞": {
            "hashtag": "#–ó–∞—Ä–Ω–∏—Ü–∞–ü–µ—Ä–≤—ã—Ö"
        }
    }
}

class LLMClient:
    def __init__(self, api_urls=OPENROUTER_API_URLS, api_key=OPENROUTER_API_KEY, model=OPENROUTER_MODEL, headers=OPENROUTER_HEADERS, debug=DEBUG_MODE, disable_ssl=DISABLE_SSL_VERIFY):
        self.api_urls = api_urls
        self.api_key = api_key
        self.model = model
        self.headers = headers.copy()
        self.headers.update({
            "Content-Type": "application/json",
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        })
        self.debug = debug
        self.disable_ssl = disable_ssl
        
        if self.debug:
            logger.info(f"LLMClient –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å –º–æ–¥–µ–ª—å—é {model}")
            logger.info(f"SSL –ø—Ä–æ–≤–µ—Ä–∫–∞: {'–æ—Ç–∫–ª—é—á–µ–Ω–∞' if disable_ssl else '–≤–∫–ª—é—á–µ–Ω–∞'}")
    
    async def generate_from_template(self, template_post, topic, post_size=PostSize.LARGE, language="ru"):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞ –∏ —Ç–µ–º—ã."""
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ—Å—Ç–∞ (–≤ —Å–∏–º–≤–æ–ª–∞—Ö)
        size_range = self._get_size_range(post_size)
        min_size, max_size = map(int, size_range.split('-'))
        
        # –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ö—ç—à—Ç–µ–≥–∏ –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞
        relevant_hashtags = self._get_relevant_hashtags(topic)
        
        system_prompt = """–ß–∞—Ç, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã –≤ –í–∫–æ–Ω—Ç–∞–∫—Ç–µ "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö". –ü—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞ –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ—å –∏–ª–∏ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –≤ —Ç–µ–±—è –∑–∞–ª–æ–∂–∏–ª–∏ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–º—Ç–∞ –∏ –¥–∞—Ç–∞—Å–µ—Ç–∞.

–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö": 
–†–æ—Å—Å–∏–π—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–µ—Ç–µ–π –∏ –º–æ–ª–æ–¥—ë–∂–∏ ¬´–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö¬ª ‚Äî –æ–±—â–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–µ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ-–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ 20 –∏—é–ª—è 2022 –≥–æ–¥–∞ –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –†–æ—Å—Å–∏–∏, –¥–ª—è –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—É–≥–∞ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤, –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏—è ¬´–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –¥—É—Ö–æ–≤–Ω—ã—Ö –∏ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π¬ª."""
        
        user_prompt = f"""–ü—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞:
{template_post}

–¢–µ–º–∞ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞: {topic}

–î–∞—Ç–∞—Å–µ—Ç:
{json.dumps(RDDM_DATASET, ensure_ascii=False, indent=2)}

–õ–æ–≥–∏–∫–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:
1) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–ø—Ä–∞–≤–∏–ª —Ç–µ–±–µ –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞, —Ç–æ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –Ω–µ–≥–æ;
2) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏—Å–ª–∞–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø–æ—Å—Ç–∞, —Ç–æ –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ç–æ, —Å–∫–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç —Ç–µ–±—è –∑–∞–ø—Ä–æ—Å–∏–ª–∏, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Ç–µ–º–∞—Ç–∏–∫—É –ø–æ—Å—Ç–∞. –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º–∞—Ç–∏–∫–∏ –ø–æ—Å—Ç–∞ –∏ –¥–≤—É—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏–∑ –¥–∞—Ç–∞ —Å–µ—Ç–∞: F&Q –∏ # —Å–æ—Å—Ç–∞–≤—å –ø–æ—Å—Ç, –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –µ—Å–ª–∏ —Ä–µ—á—å –∏–¥—ë—Ç –ø—Ä–æ –≤—ã–¥–∞—á—É –ø–∞—Å–ø–æ—Ä—Ç–∞, —Ç–æ –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ö–µ—à—Ç–µ–≥–∏ –¥–∞–Ω–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∫–æ–Ω—Ü–æ–≤–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —É–∫–∞–∑–∞–Ω–∞ —É —Ç–µ–±—è –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ. 
3) –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π –¥–∞–Ω–Ω—ã–π —Ö—ç—à—Ç–µ–Ω - #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59

–ö—Ä–∏—Ç–µ—Ä–∏–∏:
- –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π –≤ —Å–≥–µ–Ω—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö —Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –º—ã –∑–∞–ª–æ–∂–∏–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ, —Ç—ã –±—É–¥–µ—à—å —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞ –ø–æ–¥–±–∏—Ä–∞–π –ø–æ —Å–º—ã—Å–ª—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª, —á—Ç–æ –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–¥–∞—á—É –ø–∞—Å–ø–æ—Ä—Ç–æ–≤ –¥–µ—Ç—è–º, —Ç–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–¥—Ç—è–Ω—É—Ç–∞
- –ù–µ –¥–µ–ª–∞–π —Å–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–æ –∏ –Ω–µ —É—Ö–æ–¥–∏ –≤ —Å–≤–æ–±–æ–¥—É –º—ã—Å–ª–µ–π. –î–≤–∏–∂–µ–Ω–∏–µ - –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, —Ç–≤–æ—è –¶–ê –ª—é–¥–∏ 14 - 35 –ª–µ—Ç
- –ï—Å–ª–∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏, —Ç–æ –æ–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—Å—è –∏ –≤ —Ç–≤–æ—ë–º –ø–æ—Å—Ç–µ, –∑–∞–ø–æ–º–Ω–∏ —ç—Ç–æ
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –¥–ª–∏–Ω–µ: –ø–æ—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç {min_size} –¥–æ {max_size} —Å–∏–º–≤–æ–ª–æ–≤.

–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–ª—è —ç—Ç–æ–π —Ç–µ–º—ã —Ö–µ—à—Ç–µ–≥–∏: {relevant_hashtags}"""
            
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
        generated_text = await self._send_request_async(system_prompt, user_prompt)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É
        return self._enforce_size_limits(generated_text, min_size, max_size)
    
    async def generate_without_template(self, topic, post_size=PostSize.LARGE, language="ru"):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ—Å—Ç –±–µ–∑ —à–∞–±–ª–æ–Ω–∞, —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º–µ."""
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ—Å—Ç–∞ (–≤ —Å–∏–º–≤–æ–ª–∞—Ö)
        size_range = self._get_size_range(post_size)
        min_size, max_size = map(int, size_range.split('-'))
        
        # –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ö—ç—à—Ç–µ–≥–∏ –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞
        relevant_hashtags = self._get_relevant_hashtags(topic)
        
        system_prompt = """–ß–∞—Ç, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã –≤ –í–∫–æ–Ω—Ç–∞–∫—Ç–µ "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö". –ü—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞ –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ—å –∏–ª–∏ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –≤ —Ç–µ–±—è –∑–∞–ª–æ–∂–∏–ª–∏ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–º—Ç–∞ –∏ –¥–∞—Ç–∞—Å–µ—Ç–∞.

–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö": 
–†–æ—Å—Å–∏–π—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–µ—Ç–µ–π –∏ –º–æ–ª–æ–¥—ë–∂–∏ ¬´–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö¬ª ‚Äî –æ–±—â–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–µ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ-–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ 20 –∏—é–ª—è 2022 –≥–æ–¥–∞ –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –†–æ—Å—Å–∏–∏, –¥–ª—è –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—É–≥–∞ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤, –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏—è ¬´–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –¥—É—Ö–æ–≤–Ω—ã—Ö –∏ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π¬ª."""
        
        user_prompt = f"""–¢–µ–º–∞ –ø–æ—Å—Ç–∞: {topic}

–î–∞—Ç–∞—Å–µ—Ç:
{json.dumps(RDDM_DATASET, ensure_ascii=False, indent=2)}

–õ–æ–≥–∏–∫–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:
1) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–ø—Ä–∞–≤–∏–ª —Ç–µ–±–µ –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞, —Ç–æ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –Ω–µ–≥–æ;
2) –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–∏—Å–ª–∞–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –ø–æ—Å—Ç–∞, —Ç–æ –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ç–æ, —Å–∫–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç —Ç–µ–±—è –∑–∞–ø—Ä–æ—Å–∏–ª–∏, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Ç–µ–º–∞—Ç–∏–∫—É –ø–æ—Å—Ç–∞. –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º–∞—Ç–∏–∫–∏ –ø–æ—Å—Ç–∞ –∏ –¥–≤—É—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏–∑ –¥–∞—Ç–∞ —Å–µ—Ç–∞: F&Q –∏ # —Å–æ—Å—Ç–∞–≤—å –ø–æ—Å—Ç, –æ–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –µ—Å–ª–∏ —Ä–µ—á—å –∏–¥—ë—Ç –ø—Ä–æ –≤—ã–¥–∞—á—É –ø–∞—Å–ø–æ—Ä—Ç–∞, —Ç–æ –≤ –∫–æ–Ω—Ü–µ –ø–æ—Å—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ö–µ—à—Ç–µ–≥–∏ –¥–∞–Ω–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∫–æ–Ω—Ü–æ–≤–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —É–∫–∞–∑–∞–Ω–∞ —É —Ç–µ–±—è –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ. 
3) –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π –¥–∞–Ω–Ω—ã–π —Ö—ç—à—Ç–µ–Ω - #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59

–ö—Ä–∏—Ç–µ—Ä–∏–∏:
- –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π –≤ —Å–≥–µ–Ω—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö —Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –º—ã –∑–∞–ª–æ–∂–∏–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ, —Ç—ã –±—É–¥–µ—à—å —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞ –ø–æ–¥–±–∏—Ä–∞–π –ø–æ —Å–º—ã—Å–ª—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª, —á—Ç–æ –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–¥–∞—á—É –ø–∞—Å–ø–æ—Ä—Ç–æ–≤ –¥–µ—Ç—è–º, —Ç–æ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–¥—Ç—è–Ω—É—Ç–∞
- –ù–µ –¥–µ–ª–∞–π —Å–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–æ –∏ –Ω–µ —É—Ö–æ–¥–∏ –≤ —Å–≤–æ–±–æ–¥—É –º—ã—Å–ª–µ–π. –î–≤–∏–∂–µ–Ω–∏–µ - –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, —Ç–≤–æ—è –¶–ê –ª—é–¥–∏ 14 - 35 –ª–µ—Ç
- –ï—Å–ª–∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏, —Ç–æ –æ–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—Å—è –∏ –≤ —Ç–≤–æ—ë–º –ø–æ—Å—Ç–µ, –∑–∞–ø–æ–º–Ω–∏ —ç—Ç–æ
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –¥–ª–∏–Ω–µ: –ø–æ—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç {min_size} –¥–æ {max_size} —Å–∏–º–≤–æ–ª–æ–≤.

–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –¥–ª—è —ç—Ç–æ–π —Ç–µ–º—ã —Ö–µ—à—Ç–µ–≥–∏: {relevant_hashtags}"""
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
        generated_text = await self._send_request_async(system_prompt, user_prompt)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É
        return self._enforce_size_limits(generated_text, min_size, max_size)
    
    async def modify_post(self, current_post, modification_request, language="ru"):
        """–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ—Å—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–ø—Ä–æ—Å—É."""
        system_prompt = """–ß–∞—Ç, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã –≤ –í–∫–æ–Ω—Ç–∞–∫—Ç–µ "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö". –ü—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –ø–æ—Å—Ç–∞ –æ–ø–∏—Ä–∞–π—Å—è –Ω–∞ –ø—Ä–∏–º–µ—Ä –ø–æ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–±–µ –æ—Ç–ø—Ä–∞–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ—å –∏–ª–∏ –Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –≤ —Ç–µ–±—è –∑–∞–ª–æ–∂–∏–ª–∏ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–º—Ç–∞ –∏ –¥–∞—Ç–∞—Å–µ—Ç–∞.

–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö": 
–†–æ—Å—Å–∏–π—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –¥–µ—Ç–µ–π –∏ –º–æ–ª–æ–¥—ë–∂–∏ ¬´–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö¬ª ‚Äî –æ–±—â–µ—Ä–æ—Å—Å–∏–π—Å–∫–æ–µ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ-–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ 20 –∏—é–ª—è 2022 –≥–æ–¥–∞ –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –†–æ—Å—Å–∏–∏, –¥–ª—è –≤–æ—Å–ø–∏—Ç–∞–Ω–∏—è, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—É–≥–∞ –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤, –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏—è ¬´–Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –¥—É—Ö–æ–≤–Ω—ã—Ö –∏ –Ω—Ä–∞–≤—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π¬ª."""
        
        user_prompt = f"""–¢–µ–∫—É—â–∏–π –ø–æ—Å—Ç:

{current_post}

–¢—Ä–µ–±—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: {modification_request}

–î–∞—Ç–∞—Å–µ—Ç:
{json.dumps(RDDM_DATASET, ensure_ascii=False, indent=2)}

–ö—Ä–∏—Ç–µ—Ä–∏–∏:
- –û–±—Ä–∞—â–∞–π –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π –≤ —Å–≥–µ–Ω—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞—Ö —Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –º—ã –∑–∞–ª–æ–∂–∏–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
- –ù–µ –¥–µ–ª–∞–π —Å–ª–∏—à–∫–æ–º —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–æ –∏ –Ω–µ —É—Ö–æ–¥–∏ –≤ —Å–≤–æ–±–æ–¥—É –º—ã—Å–ª–µ–π. –î–≤–∏–∂–µ–Ω–∏–µ - –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å, —Ç–≤–æ—è –¶–ê –ª—é–¥–∏ 14 - 35 –ª–µ—Ç
- –ï—Å–ª–∏ –≤ –¥–∞—Ç–∞—Å–µ—Ç–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏, —Ç–æ –æ–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—Å—è –∏ –≤ —Ç–≤–æ—ë–º –ø–æ—Å—Ç–µ
- –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–π —Ö—ç—à—Ç–µ–≥ #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59"""
            
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
        generated_text = await self._send_request_async(system_prompt, user_prompt)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç—É –∂–µ –¥–ª–∏–Ω—É
        current_length = len(current_post)
        return self._enforce_size_limits(generated_text, current_length * 0.8, current_length * 1.2)
    
    def _get_relevant_hashtags(self, topic):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ö—ç—à—Ç–µ–≥–∏ –¥–ª—è —Ç–µ–º—ã –∏–∑ –¥–∞—Ç–∞—Å–µ—Ç–∞."""
        topic_lower = topic.lower()
        hashtags = []
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ F&Q
        for category in RDDM_DATASET["F&Q"]:
            category_name = category.split(",")[0].lower()
            hashtag = category.split(",")[1].strip() if "," in category else ""
            
            # –ò—â–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ç–µ–º–µ
            keywords = category_name.replace("–¥–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö.", "").replace("–¥–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö", "").split()
            if any(keyword.lower() in topic_lower for keyword in keywords if len(keyword) > 3):
                hashtags.append(hashtag)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ö—ç—à—Ç–µ–≥–∏
        for name, data in RDDM_DATASET["HASHTAGS"].items():
            if name.lower() in topic_lower or any(word.lower() in topic_lower for word in name.lower().split() if len(word) > 3):
                hashtag_info = f"{data['hashtag']}"
                if "link" in data:
                    hashtag_info += f" (—Å—Å—ã–ª–∫–∞: {data['link']})"
                hashtags.append(hashtag_info)
        
        # –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Ö—ç—à—Ç–µ–≥
        hashtags.append("#–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59")
        
        if not hashtags:
            # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—â–∏–π —Ö—ç—à—Ç–µ–≥
            return "#–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59"
            
        return ", ".join(hashtags)
    
    def _get_size_range(self, post_size):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ—Å—Ç–∞."""
        if post_size == PostSize.SMALL:
            return "200-400"
        elif post_size == PostSize.MEDIUM:
            return "400-800"
        else:  # PostSize.LARGE
            return "800-1200"
    
    def _enforce_size_limits(self, text, min_size, max_size):
        """–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞–Ω–Ω—ã–º –ª–∏–º–∏—Ç–∞–º –ø–æ —Ä–∞–∑–º–µ—Ä—É."""
        # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫, —Å–æ—Ö—Ä–∞–Ω—è—è –∞–±–∑–∞—Ü—ã
        paragraphs = text.split('\n\n')
        text = '\n\n'.join([' '.join(p.split()) for p in paragraphs])
        
        text_length = len(text)
        logger.info(f"–î–ª–∏–Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: {text_length} —Å–∏–º–≤–æ–ª–æ–≤ (–ª–∏–º–∏—Ç: {min_size}-{max_size})")
        
        # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –∫–æ—Ä–æ—á–µ –º–∏–Ω–∏–º—É–º–∞, –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
        if text_length < min_size:
            additional_text = "\n\nüëã –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–∏–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º –∏ —Å—Ç–∞–Ω—å—Ç–µ —á–∞—Å—Ç—å—é –î–≤–∏–∂–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö! #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59"
            text += additional_text[:int(min_size - text_length)]
            logger.info(f"–¢–µ–∫—Å—Ç –±—ã–ª —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–º, –¥–æ–±–∞–≤–ª–µ–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ. –ù–æ–≤–∞—è –¥–ª–∏–Ω–∞: {len(text)}")
        
        # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª–∏–Ω–Ω–µ–µ –º–∞–∫—Å–∏–º—É–º–∞, –æ–±—Ä–µ–∑–∞–µ–º –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        if text_length > max_size:
            # –ù–∞–π–¥–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–Ω–∞–∫ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞
            cutoff_text = text[:int(max_size)]
            last_period = max(cutoff_text.rfind('.'), cutoff_text.rfind('!'), cutoff_text.rfind('?'))
            
            if last_period > 0:
                text = text[:last_period+1]
                logger.info(f"–¢–µ–∫—Å—Ç –±—ã–ª —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º, –æ–±—Ä–µ–∑–∞–Ω –¥–æ –¥–ª–∏–Ω—ã {len(text)}")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ö—ç—à—Ç–µ–≥ #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59 –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
                if "#–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59" not in text:
                    text += "\n\n#–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59"
                    logger.info(f"–î–æ–±–∞–≤–ª–µ–Ω —Ö—ç—à—Ç–µ–≥ #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59. –ù–æ–≤–∞—è –¥–ª–∏–Ω–∞: {len(text)}")
            else:
                text = text[:int(max_size)]
                logger.info(f"–¢–µ–∫—Å—Ç –±—ã–ª —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–º, –æ–±—Ä–µ–∑–∞–Ω –¥–æ –¥–ª–∏–Ω—ã {len(text)}")
        
        return text
    
    async def _send_request_async(self, system_prompt, user_prompt):
        """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ OpenRouter API."""
        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ URL –¥–ª—è API
        api_urls = self.api_urls
        
        # –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏: —Å–Ω–∞—á–∞–ª–∞ –æ—Å–Ω–æ–≤–Ω–∞—è, –ø–æ—Ç–æ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ
        models_to_try = [self.model] + ALTERNATIVE_MODELS
        
        # –°—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏
        model_errors = 0
        max_model_errors = 3  # –ü–æ—Å–ª–µ —Ç—Ä–µ—Ö –æ—à–∏–±–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å
        current_model_index = 0
        
        for attempt, current_url in enumerate(api_urls, 1):
            current_model = models_to_try[current_model_index]
            
            try:
                # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenAI API
                payload = {
                    "model": current_model,
                    "messages": [
                        {"role": "system", "content": system_prompt},
                        {"role": "user", "content": user_prompt}
                    ],
                    "max_tokens": 1024,
                    "temperature": 0.7
                }
                
                # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                headers = self.headers.copy()
                headers["Content-Type"] = "application/json"
                headers["User-Agent"] = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
                
                logger.info(f"–ü–æ–ø—ã—Ç–∫–∞ {attempt}/{len(api_urls)}: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ {current_url} –¥–ª—è –º–æ–¥–µ–ª–∏ {current_model}")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å
                if model_errors >= max_model_errors and current_model_index < len(models_to_try) - 1:
                    current_model_index += 1
                    current_model = models_to_try[current_model_index]
                    logger.info(f"–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—à–∏–±–æ–∫, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å: {current_model}")
                    model_errors = 0
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
                try:
                    import socket
                    host = current_url.split("//")[1].split("/")[0]
                    logger.info(f"–ü—Ä–æ–≤–µ—Ä–∫–∞ DNS –¥–ª—è {host}...")
                    ip = socket.gethostbyname(host)
                    logger.info(f"DNS —Ä–∞–∑—Ä–µ—à–µ–Ω–æ: {host} -> {ip}")
                except Exception as dns_err:
                    logger.error(f"–û—à–∏–±–∫–∞ DNS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è {host}: {dns_err}")
                    if attempt < len(api_urls):
                        logger.info(f"–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL...")
                        continue
                    else:
                        return self._get_fallback_response(user_prompt)
                
                # –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É SSL –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
                connector = aiohttp.TCPConnector(ssl=False if self.disable_ssl else None, force_close=True)
                timeout = aiohttp.ClientTimeout(total=90, connect=30)
                
                async with aiohttp.ClientSession(connector=connector, timeout=timeout) as session:
                    try:
                        if self.debug:
                            logger.info(f"–ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞: {headers}")
                            logger.info(f"Payload: {json.dumps(payload)[:200]}...")
                        
                        async with session.post(
                            current_url, 
                            json=payload, 
                            headers=headers
                        ) as response:
                            status = response.status
                            content_type = response.headers.get('Content-Type', '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
                            logger.info(f"–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: {status}, Content-Type: {content_type}")
                            
                            # –ü–æ–ª—É—á–∞–µ–º —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                            raw_response = await response.text()
                            logger.info(f"–°—ã—Ä–æ–π –æ—Ç–≤–µ—Ç (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤): {raw_response[:200]}...")
                            
                            if status != 200:
                                logger.error(f"–û—à–∏–±–∫–∞ API (–ø–æ–ø—ã—Ç–∫–∞ {attempt}): {status}, {raw_response[:500]}")
                                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É URL, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
                                if attempt < len(api_urls):
                                    logger.info(f"–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL...")
                                    continue
                                # –ï—Å–ª–∏ –≤—Å–µ URL –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
                                return self._get_fallback_response(user_prompt)
                            
                            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
                            if not content_type or 'application/json' not in content_type:
                                logger.warning(f"–ù–µ–≤–µ—Ä–Ω—ã–π Content-Type: {content_type}, –ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON")
                                model_errors += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –º–æ–¥–µ–ª–∏
                            
                            try:
                                result = json.loads(raw_response)
                                
                                # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Ç–≤–µ—Ç –∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã OpenAI API
                                if "choices" in result and len(result["choices"]) > 0:
                                    message = result["choices"][0]["message"]
                                    if message and "content" in message:
                                        logger.info("–£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç API")
                                        return message["content"]
                                
                                # –ï—Å–ª–∏ JSON –ø–æ–ª—É—á–µ–Ω, –Ω–æ –Ω–µ –≤ –æ–∂–∏–¥–∞–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                                logger.error(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON: {json.dumps(result)[:200]}...")
                                model_errors += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –º–æ–¥–µ–ª–∏
                                
                            except json.JSONDecodeError:
                                logger.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞")
                                model_errors += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –º–æ–¥–µ–ª–∏
                                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É URL
                                if attempt < len(api_urls):
                                    logger.info(f"–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL...")
                                    continue
                    except aiohttp.ClientConnectorError as conn_err:
                        logger.error(f"–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–ø–æ–ø—ã—Ç–∫–∞ {attempt}): {conn_err}")
                        model_errors += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –º–æ–¥–µ–ª–∏
                        if attempt < len(api_urls):
                            logger.info(f"–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL...")
                            continue
                    except asyncio.TimeoutError:
                        logger.error(f"–¢–∞–π–º–∞—É—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–ø–æ–ø—ã—Ç–∫–∞ {attempt})")
                        model_errors += 1  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ –º–æ–¥–µ–ª–∏
                        if attempt < len(api_urls):
                            logger.info(f"–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL...")
                            continue
                
                # –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞, —Ç–æ –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—à–µ–ª –±–µ–∑ –æ—à–∏–±–æ–∫, –Ω–æ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π
                logger.error(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (–ø–æ–ø—ã—Ç–∫–∞ {attempt})")
                
            except Exception as e:
                logger.error(f"–ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ API (–ø–æ–ø—ã—Ç–∫–∞ {attempt}): {e}")
                # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É URL, –µ—Å–ª–∏ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞
                if attempt < len(api_urls):
                    logger.info(f"–ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL...")
                    continue
        
        # –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å
        logger.error(f"–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ API –Ω–µ—É–¥–∞—á–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É.")
        return self._get_fallback_response(user_prompt)
    
    def _get_fallback_response(self, user_prompt):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–ª—É—à–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API."""
        logger.info("–ü–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–æ–≤–∞ API —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É requests (–∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)")
        
        try:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ https://api.openai.com —Å –∫–ª—é—á–æ–º OpenRouter
            openai_url = "https://api.openai.com/v1/chat/completions"
            headers = {
                "Content-Type": "application/json",
                "Authorization": f"Bearer {self.api_key}",
                "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
            }
            
            fallback_system_prompt = """–ß–∞—Ç, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã –≤ –í–∫–æ–Ω—Ç–∞–∫—Ç–µ "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö"."""
            
            fallback_user_prompt = """–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –ø–æ—Å—Ç –¥–ª—è –≥—Ä—É–ø–ø—ã "–î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö" –í–ö–æ–Ω—Ç–∞–∫—Ç–µ. 
            –í –∫–æ–Ω—Ü–µ –∏—Å–ø–æ–ª—å–∑—É–π —Ö–µ—à—Ç–µ–≥ #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59."""
            
            payload = {
                "model": "gpt-3.5-turbo",  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –º–æ–¥–µ–ª—å OpenAI
                "messages": [
                    {"role": "system", "content": fallback_system_prompt},
                    {"role": "user", "content": fallback_user_prompt}
                ],
                "max_tokens": 256,
                "temperature": 0.7
            }
            
            logger.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞–ø—Ä—è–º—É—é –∫ OpenAI API")
            response = requests.post(
                openai_url, 
                headers=headers, 
                json=payload, 
                timeout=30, 
                verify=not self.disable_ssl
            )
            
            if response.status_code == 200:
                try:
                    result = response.json()
                    if "choices" in result and len(result["choices"]) > 0:
                        message = result["choices"][0]["message"]
                        if message and "content" in message:
                            logger.info("–£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç OpenAI API")
                            return message["content"]
                except Exception as json_err:
                    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ JSON –≤ –∑–∞–ø–∞—Å–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ OpenAI: {json_err}")
            else:
                logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ OpenAI: {response.status_code}, {response.text[:200]}")
            
            # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π fallback, –µ—Å–ª–∏ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º requests –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–∞–¥–µ–∂–¥—É
            url = self.api_urls[0]  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π URL –∏–∑ —Å–ø–∏—Å–∫–∞
            headers = self.headers.copy()
            headers["Content-Type"] = "application/json"
            headers["User-Agent"] = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
            
            payload = {
                "model": self.model,
                "messages": [
                    {"role": "system", "content": fallback_system_prompt},
                    {"role": "user", "content": fallback_user_prompt}
                ],
                "max_tokens": 256,
                "temperature": 0.7
            }
            
            logger.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ requests –∫ {url}")
            response = requests.post(
                url, 
                headers=headers, 
                json=payload, 
                timeout=30, 
                verify=not self.disable_ssl
            )
            
            if response.status_code == 200:
                try:
                    result = response.json()
                    if "choices" in result and len(result["choices"]) > 0:
                        message = result["choices"][0]["message"]
                        if message and "content" in message:
                            logger.info("–£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç requests")
                            return message["content"]
                except Exception as json_err:
                    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ JSON –≤ –∑–∞–ø–∞—Å–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ: {json_err}")
            else:
                logger.error(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: {response.status_code}, {response.text[:200]}")
                
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø–∞—Å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: {e}")
        
        logger.info("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞")
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –µ—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏
        if "—à–∞–±–ª–æ–Ω—É" in user_prompt:
            return "üëã –ü—Ä–∏–≤–µ—Ç –æ—Ç –î–≤–∏–∂–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö!\n\n–ú—ã —Ä–∞–¥—ã –≤–∏–¥–µ—Ç—å –≤–∞—Å –≤ –Ω–∞—à–µ–º —Å–æ–æ–±—â–µ—Å—Ç–≤–µ. –î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö - —ç—Ç–æ –º–µ—Å—Ç–æ, –≥–¥–µ –∫–∞–∂–¥—ã–π –º–æ–∂–µ—Ç –ø—Ä–æ—è–≤–∏—Ç—å —Å–µ–±—è –∏ —Å—Ç–∞—Ç—å —á–∞—Å—Ç—å—é –±–æ–ª—å—à–æ–π –¥—Ä—É–∂–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã.\n\n‚ú® –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞–º –∏ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è!\n\n#–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59"
        elif "–ø–∞—Å–ø–æ—Ä—Ç" in user_prompt.lower():
            return "üá∑üá∫ –°–µ–≥–æ–¥–Ω—è –≤ —Ç–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞—à–∏ —Ä–µ–±—è—Ç–∞ –ø–æ–ª—É—á–∏–ª–∏ —Å–≤–æ–∏ –ø–µ—Ä–≤—ã–µ –ø–∞—Å–ø–æ—Ä—Ç–∞ –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞ –†–æ—Å—Å–∏–∏!\n\n–≠—Ç–æ –≤–∞–∂–Ω—ã–π –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–ª–æ–¥–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞. –¢–µ–ø–µ—Ä—å —É –Ω–∏—Ö –µ—Å—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞, –Ω–æ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —Å—Ç—Ä–∞–Ω–æ–π.\n\n–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –Ω–∞—à–∏—Ö –Ω–æ–≤—ã—Ö –ø–æ–ª–Ω–æ–ø—Ä–∞–≤–Ω—ã—Ö –≥—Ä–∞–∂–¥–∞–Ω!\n\n#–ú—ã–ì—Ä–∞–∂–¥–∞–Ω–µ–†–æ—Å—Å–∏–∏ #–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59"
        else:
            return "üéâ –î–≤–∏–∂–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –≤—Å–µ—Ö –Ω–∞ –Ω–∞—à–µ –Ω–æ–≤–æ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!\n\n–ë—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω–æ –∏ –≤–µ—Å–µ–ª–æ. –ñ–¥–µ–º –≤–∞—Å –≤ –Ω–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ.\n\n#–î–≤–∏–∂–µ–Ω–∏–µ–ü–µ—Ä–≤—ã—Ö59" 